<!-- ver 0.2, card css updated -->
<!-- ver 0.3, get webinars and automatically generate cards. -->
<!-- ver 0.4, Feat: Zoom API request -->
<!-- ver 0.5, Fix: Get metadata according to title tag. (ex. [Asia] Session #1) -->

<!-- check logged in state. if not, redirect to sign-in page -->
<script>
  if (jQuery("body").hasClass("logged-in")) {
  }
  else {
    window.location = "/sign-in?url=%2Flecture-hall%2F"
  }
</script>
<!--  -->

<div class="lecture-hall-wrap">
  <video src="https://d25unujvh7ui3r.cloudfront.net/lecture_hall.mp4" alt="lecture hall" muted autoplay loop></video>
</div>

<div class="meeting-container"></div>

<style>
  /* reset */
  p {
    margin: 0;
  }

  #vczapi-show-webinars-list-table_wrapper,
  .vczapi-wrap.vczapi-items-wrap {
    display: none;
  }

  .meeting-container {
    display: flex;
    top: 60px;
    position: absolute;
    margin: 80px;
    flex-wrap: wrap;
  }

  .card {
    display: flex;
    flex-direction: column;
    background-color: #ebf5fc;
    align-items: center;
    padding: 25px;
    border-radius: 15px;
    box-shadow: 3px 3px 12px #00000070;
  }

  .card:not(:last-child) {
    margin-right: 20px;
  }

  .link-btn-wrap {
    margin-top: 15px;
  }

  .link-btn {
    background-color: #21ade5;
    padding: 5px 10px;
    color: #fff;
    border-radius: 7px;
    font-size: 18px;
  }

  .link-btn:hover {
    background: #ff568f;
    color: white;
  }

  .link-zoom-app {
    font-size: 16px;
  }

  .zoom-start-date,
  .zoom-timezone {
    color: #8a8a8a;
  }

  /* background */
  .lecture-hall-wrap {
    position: relative;
    height: 100vh;
  }

  video {
    height: 100%;
    object-fit: cover;
    object-position: center top;
  }
</style>

<script>
  var $vcz_list = null,
    $container = null;

  const nation = location.host.replace(".nanoscientific.org", "");
  const nation_alt = "alternative";

  function copy_metadata() {
    // get each zoom api data -> allocate to each cards.
    var $card_list = jQuery(".card");
    var metadata_arr = [];
    var card_idx = 0;

    $vcz_list.each(function () {
      var $this = this;
      var i = 0;
      var browser_link = jQuery(".vczapi-btn-link")[card_idx].href;
      jQuery($this.children).each(function () {
        if (this.children.length === 0) {
          // text
          metadata_arr[i] = this.innerText;
        }
        else {
          // anchor
          metadata_arr[i] = this.children[0].href;
        }
        i++;
      });
      var $card_template = jQuery(`
      <div class="card">
        <h1 class="zoom-title">${metadata_arr[0]}</h1>
        <p class="zoom-start-date">Start:&nbsp;<strong>${metadata_arr[1]}</strong></p>
        <p class="zoom-timezone">Timezone:&nbsp;<strong>${metadata_arr[2]}</strong></p>
        <div class="link-btn-wrap">
          <a href="${metadata_arr[3]}"
          class="link-btn link-zoom-app" target="_blank">Join
          via Zoom App</a>
          </div>
          <div class="link-btn-wrap">
            <a href="${browser_link}" target="_blank" class="link-btn"
            class="browser_link">Join via browser</a>
            </div>
            </div>
      `);
      $card_template.appendTo($container);
      card_idx++;
    });
  }

  function filter_meetings(index, $this) {
    var start = $this.children[0].innerText.indexOf('[') + 1;
    var end = $this.children[0].innerText.indexOf(']');
    var tag = $this.children[0].innerText.substring(start, end).toLowerCase();

    return (tag === nation || tag === nation_alt);
  }

  function init() {
    window.addEventListener("DOMContentLoaded", function () {
      $vcz_list = jQuery("#vczapi-show-webinars-list-table tbody tr").filter(filter_meetings);
      // get number of webinars
      const num_of_webinars = $vcz_list.length;

      copy_metadata();
    }),
      $container = jQuery(".meeting-container");


  }

  init();
</script>